# File generated from our OpenAPI spec
defmodule Stripe.Resources.SetupIntent do
  @moduledoc """
  SetupIntent

  A SetupIntent guides you through the process of setting up and saving a customer's payment credentials for future payments.
  For example, you can use a SetupIntent to set up and save your customer's card without immediately collecting a payment.
  Later, you can use [PaymentIntents](https://api.stripe.com#payment_intents) to drive the payment flow.

  Create a SetupIntent when you're ready to collect your customer's payment credentials.
  Don't maintain long-lived, unconfirmed SetupIntents because they might not be valid.
  The SetupIntent transitions through multiple [statuses](https://docs.stripe.com/payments/intents#intent-statuses) as it guides
  you through the setup process.

  Successful SetupIntents result in payment credentials that are optimized for future payments.
  For example, cardholders in [certain regions](https://stripe.com/guides/strong-customer-authentication) might need to be run through
  [Strong Customer Authentication](https://docs.stripe.com/strong-customer-authentication) during payment method collection
  to streamline later [off-session payments](https://docs.stripe.com/payments/setup-intents).
  If you use the SetupIntent with a [Customer](https://api.stripe.com#setup_intent_object-customer),
  it automatically attaches the resulting payment method to that Customer after successful setup.
  We recommend using SetupIntents or [setup_future_usage](https://api.stripe.com#payment_intent_object-setup_future_usage) on
  PaymentIntents to save payment methods to prevent saving invalid or unoptimized payment methods.

  By using SetupIntents, you can reduce friction for your customers, even as regulations change over time.

  Related guide: [Setup Intents API](https://docs.stripe.com/payments/setup-intents)
  """

  @typedoc """
  * `application` - ID of the Connect application that created the SetupIntent. Nullable. Expandable.
  * `attach_to_self` - If present, the SetupIntent's payment method will be attached to the in-context Stripe Account.

  It can only be used for this Stripe Accountâ€™s own money movement flows like InboundTransfer and OutboundTransfers. It cannot be set to true when setting up a PaymentMethod for a Customer, and defaults to false when attaching a PaymentMethod to a Customer.
  * `automatic_payment_methods` - Settings for dynamic payment methods compatible with this Setup Intent Nullable. Expandable.
  * `cancellation_reason` - Reason for cancellation of this SetupIntent, one of `abandoned`, `requested_by_customer`, or `duplicate`. Possible values: `abandoned`, `duplicate`, `requested_by_customer`. Nullable.
  * `client_secret` - The client secret of this SetupIntent. Used for client-side retrieval using a publishable key.

  The client secret can be used to complete payment setup from your frontend. It should not be stored, logged, or exposed to anyone other than the customer. Make sure that you have TLS enabled on any page that includes the client secret. Max length: 5000. Nullable.
  * `created` - Time at which the object was created. Measured in seconds since the Unix epoch. Format: Unix timestamp.
  * `customer` - ID of the Customer this SetupIntent belongs to, if one exists.

  If present, the SetupIntent's payment method will be attached to the Customer on successful setup. Payment methods attached to other Customers cannot be used with this SetupIntent. Nullable. Expandable.
  * `customer_account` - ID of the Account this SetupIntent belongs to, if one exists.

  If present, the SetupIntent's payment method will be attached to the Account on successful setup. Payment methods attached to other Accounts cannot be used with this SetupIntent. Max length: 5000. Nullable.
  * `description` - An arbitrary string attached to the object. Often useful for displaying to users. Max length: 5000. Nullable.
  * `excluded_payment_method_types` - Payment method types that are excluded from this SetupIntent. Nullable.
  * `flow_directions` - Indicates the directions of money movement for which this payment method is intended to be used.

  Include `inbound` if you intend to use the payment method as the origin to pull funds from. Include `outbound` if you intend to use the payment method as the destination to send funds to. You can include both if you intend to use the payment method for both purposes. Nullable.
  * `id` - Unique identifier for the object. Max length: 5000.
  * `last_setup_error` - The error encountered in the previous SetupIntent confirmation. Nullable. Expandable.
  * `latest_attempt` - The most recent SetupAttempt for this SetupIntent. Nullable. Expandable.
  * `livemode` - Has the value `true` if the object exists in live mode or the value `false` if the object exists in test mode.
  * `mandate` - ID of the multi use Mandate generated by the SetupIntent. Nullable. Expandable.
  * `metadata` - Set of [key-value pairs](https://docs.stripe.com/api/metadata) that you can attach to an object. This can be useful for storing additional information about the object in a structured format. Nullable.
  * `next_action` - If present, this property tells you what actions you need to take in order for your customer to continue payment setup. Nullable. Expandable.
  * `object` - String representing the object's type. Objects of the same type share the same value. Possible values: `setup_intent`.
  * `on_behalf_of` - The account (if any) for which the setup is intended. Nullable. Expandable.
  * `payment_method` - ID of the payment method used with this SetupIntent. If the payment method is `card_present` and isn't a digital wallet, then the [generated_card](https://docs.stripe.com/api/setup_attempts/object#setup_attempt_object-payment_method_details-card_present-generated_card) associated with the `latest_attempt` is attached to the Customer instead. Nullable. Expandable.
  * `payment_method_configuration_details` - Information about the [payment method configuration](https://docs.stripe.com/api/payment_method_configurations) used for this Setup Intent. Nullable. Expandable.
  * `payment_method_options` - Payment method-specific configuration for this SetupIntent. Nullable. Expandable.
  * `payment_method_types` - The list of payment method types (e.g. card) that this SetupIntent is allowed to set up. A list of valid payment method types can be found [here](https://docs.stripe.com/api/payment_methods/object#payment_method_object-type).
  * `single_use_mandate` - ID of the single_use Mandate generated by the SetupIntent. Nullable. Expandable.
  * `status` - [Status](https://docs.stripe.com/payments/intents#intent-statuses) of this SetupIntent, one of `requires_payment_method`, `requires_confirmation`, `requires_action`, `processing`, `canceled`, or `succeeded`. Possible values: `canceled`, `processing`, `requires_action`, `requires_confirmation`, `requires_payment_method`, `succeeded`.
  * `usage` - Indicates how the payment method is intended to be used in the future.

  Use `on_session` if you intend to only reuse the payment method when the customer is in your checkout flow. Use `off_session` if your customer may or may not be in your checkout flow. If not provided, this value defaults to `off_session`. Max length: 5000.
  """
  @type t :: %__MODULE__{
          application: String.t() | Stripe.Resources.Application.t(),
          attach_to_self: boolean() | nil,
          automatic_payment_methods: __MODULE__.AutomaticPaymentMethods.t(),
          cancellation_reason: String.t(),
          client_secret: String.t(),
          created: integer(),
          customer: String.t() | Stripe.Resources.Customer.t(),
          customer_account: String.t() | nil,
          description: String.t(),
          excluded_payment_method_types: [String.t()],
          flow_directions: [String.t()] | nil,
          id: String.t(),
          last_setup_error: Stripe.Resources.StripeError.t(),
          latest_attempt: String.t() | Stripe.Resources.SetupAttempt.t(),
          livemode: boolean(),
          mandate: String.t() | Stripe.Resources.Mandate.t(),
          metadata: %{String.t() => String.t()},
          next_action: __MODULE__.NextAction.t(),
          object: String.t(),
          on_behalf_of: String.t() | Stripe.Resources.Account.t(),
          payment_method: String.t() | Stripe.Resources.PaymentMethod.t(),
          payment_method_configuration_details: __MODULE__.PaymentMethodConfigurationDetails.t(),
          payment_method_options: __MODULE__.PaymentMethodOptions.t(),
          payment_method_types: [String.t()],
          single_use_mandate: String.t() | Stripe.Resources.Mandate.t(),
          status: String.t(),
          usage: String.t()
        }

  defstruct [
    :application,
    :attach_to_self,
    :automatic_payment_methods,
    :cancellation_reason,
    :client_secret,
    :created,
    :customer,
    :customer_account,
    :description,
    :excluded_payment_method_types,
    :flow_directions,
    :id,
    :last_setup_error,
    :latest_attempt,
    :livemode,
    :mandate,
    :metadata,
    :next_action,
    :object,
    :on_behalf_of,
    :payment_method,
    :payment_method_configuration_details,
    :payment_method_options,
    :payment_method_types,
    :single_use_mandate,
    :status,
    :usage
  ]

  @object_name "setup_intent"
  def object_name, do: @object_name

  def expandable_fields,
    do: [
      "application",
      "automatic_payment_methods",
      "customer",
      "last_setup_error",
      "latest_attempt",
      "mandate",
      "next_action",
      "on_behalf_of",
      "payment_method",
      "payment_method_configuration_details",
      "payment_method_options",
      "single_use_mandate"
    ]

  defmodule AutomaticPaymentMethods do
    @moduledoc "Nested struct within the parent resource."

    @typedoc """
    * `allow_redirects` - Controls whether this SetupIntent will accept redirect-based payment methods.

    Redirect-based payment methods may require your customer to be redirected to a payment method's app or site for authentication or additional steps. To [confirm](https://docs.stripe.com/api/setup_intents/confirm) this SetupIntent, you may be required to provide a `return_url` to redirect customers back to your site after they authenticate or complete the setup. Possible values: `always`, `never`.
    * `enabled` - Automatically calculates compatible payment methods Nullable.
    """
    @type t :: %__MODULE__{
            allow_redirects: String.t() | nil,
            enabled: boolean() | nil
          }
    defstruct [:allow_redirects, :enabled]
  end

  defmodule NextAction do
    @moduledoc "Nested struct within the parent resource."

    @typedoc """
    * `cashapp_handle_redirect_or_display_qr_code`
    * `redirect_to_url`
    * `type` - Type of the next action to perform. Refer to the other child attributes under `next_action` for available values. Examples include: `redirect_to_url`, `use_stripe_sdk`, `alipay_handle_redirect`, `oxxo_display_details`, or `verify_with_microdeposits`. Max length: 5000.
    * `use_stripe_sdk` - When confirming a SetupIntent with Stripe.js, Stripe.js depends on the contents of this dictionary to invoke authentication flows. The shape of the contents is subject to change and is only intended to be used by Stripe.js.
    * `verify_with_microdeposits`
    """
    @type t :: %__MODULE__{
            cashapp_handle_redirect_or_display_qr_code:
              Stripe.Resources.CashappHandleRedirectOrDisplayQrCode.t() | nil,
            redirect_to_url: Stripe.Resources.NextActionRedirectToUrl.t() | nil,
            type: String.t() | nil,
            use_stripe_sdk: map() | nil,
            verify_with_microdeposits: __MODULE__.VerifyWithMicrodeposits.t() | nil
          }
    defstruct [
      :cashapp_handle_redirect_or_display_qr_code,
      :redirect_to_url,
      :type,
      :use_stripe_sdk,
      :verify_with_microdeposits
    ]

    defmodule VerifyWithMicrodeposits do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `arrival_date` - The timestamp when the microdeposits are expected to land. Format: Unix timestamp.
      * `hosted_verification_url` - The URL for the hosted verification page, which allows customers to verify their bank account. Max length: 5000.
      * `microdeposit_type` - The type of the microdeposit sent to the customer. Used to distinguish between different verification methods. Possible values: `amounts`, `descriptor_code`. Nullable.
      """
      @type t :: %__MODULE__{
              arrival_date: integer() | nil,
              hosted_verification_url: String.t() | nil,
              microdeposit_type: String.t() | nil
            }
      defstruct [:arrival_date, :hosted_verification_url, :microdeposit_type]
    end

    def __inner_types__ do
      %{
        "verify_with_microdeposits" => __MODULE__.VerifyWithMicrodeposits
      }
    end
  end

  defmodule PaymentMethodConfigurationDetails do
    @moduledoc "Nested struct within the parent resource."

    @typedoc """
    * `id` - ID of the payment method configuration used. Max length: 5000.
    * `parent` - ID of the parent payment method configuration used. Max length: 5000. Nullable.
    """
    @type t :: %__MODULE__{
            id: String.t() | nil,
            parent: String.t() | nil
          }
    defstruct [:id, :parent]
  end

  defmodule PaymentMethodOptions do
    @moduledoc "Nested struct within the parent resource."

    @typedoc """
    * `acss_debit`
    * `amazon_pay`
    * `bacs_debit`
    * `card`
    * `card_present`
    * `klarna`
    * `link`
    * `paypal`
    * `payto`
    * `sepa_debit`
    * `us_bank_account`
    """
    @type t :: %__MODULE__{
            acss_debit: __MODULE__.AcssDebit.t() | nil,
            amazon_pay: map() | nil,
            bacs_debit: __MODULE__.BacsDebit.t() | nil,
            card: __MODULE__.Card.t() | nil,
            card_present: map() | nil,
            klarna: __MODULE__.Klarna.t() | nil,
            link: __MODULE__.Link.t() | nil,
            paypal: __MODULE__.Paypal.t() | nil,
            payto: __MODULE__.Payto.t() | nil,
            sepa_debit: __MODULE__.SepaDebit.t() | nil,
            us_bank_account: __MODULE__.UsBankAccount.t() | nil
          }
    defstruct [
      :acss_debit,
      :amazon_pay,
      :bacs_debit,
      :card,
      :card_present,
      :klarna,
      :link,
      :paypal,
      :payto,
      :sepa_debit,
      :us_bank_account
    ]

    defmodule AcssDebit do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `currency` - Currency supported by the bank account Possible values: `cad`, `usd`. Nullable.
      * `mandate_options`
      * `verification_method` - Bank account verification method. Possible values: `automatic`, `instant`, `microdeposits`.
      """
      @type t :: %__MODULE__{
              currency: String.t() | nil,
              mandate_options: __MODULE__.MandateOptions.t() | nil,
              verification_method: String.t() | nil
            }
      defstruct [:currency, :mandate_options, :verification_method]

      defmodule MandateOptions do
        @moduledoc "Nested struct within the parent resource."

        @typedoc """
        * `custom_mandate_url` - A URL for custom mandate text Max length: 5000.
        * `default_for` - List of Stripe products where this mandate can be selected automatically.
        * `interval_description` - Description of the interval. Only required if the 'payment_schedule' parameter is 'interval' or 'combined'. Max length: 5000. Nullable.
        * `payment_schedule` - Payment schedule for the mandate. Possible values: `combined`, `interval`, `sporadic`. Nullable.
        * `transaction_type` - Transaction type of the mandate. Possible values: `business`, `personal`. Nullable.
        """
        @type t :: %__MODULE__{
                custom_mandate_url: String.t() | nil,
                default_for: [String.t()] | nil,
                interval_description: String.t() | nil,
                payment_schedule: String.t() | nil,
                transaction_type: String.t() | nil
              }
        defstruct [
          :custom_mandate_url,
          :default_for,
          :interval_description,
          :payment_schedule,
          :transaction_type
        ]
      end

      def __inner_types__ do
        %{
          "mandate_options" => __MODULE__.MandateOptions
        }
      end
    end

    defmodule BacsDebit do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `mandate_options`
      """
      @type t :: %__MODULE__{
              mandate_options: Stripe.Resources.BacsDebitMandateOptions.t() | nil
            }
      defstruct [:mandate_options]
    end

    defmodule Card do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `mandate_options` - Configuration options for setting up an eMandate for cards issued in India. Nullable.
      * `network` - Selected network to process this SetupIntent on. Depends on the available networks of the card attached to the setup intent. Can be only set confirm-time. Possible values: `amex`, `cartes_bancaires`, `diners`, `discover`, `eftpos_au`, `girocard`, `interac`, `jcb`, `link`, `mastercard`, `unionpay`, `unknown`, `visa`. Nullable.
      * `request_three_d_secure` - We strongly recommend that you rely on our SCA Engine to automatically prompt your customers for authentication based on risk level and [other requirements](https://docs.stripe.com/strong-customer-authentication). However, if you wish to request 3D Secure based on logic from your own fraud engine, provide this option. If not provided, this value defaults to `automatic`. Read our guide on [manually requesting 3D Secure](https://docs.stripe.com/payments/3d-secure/authentication-flow#manual-three-ds) for more information on how this configuration interacts with Radar and our SCA Engine. Possible values: `any`, `automatic`, `challenge`. Nullable.
      """
      @type t :: %__MODULE__{
              mandate_options: Stripe.Resources.MandateOptions.t() | nil,
              network: String.t() | nil,
              request_three_d_secure: String.t() | nil
            }
      defstruct [:mandate_options, :network, :request_three_d_secure]
    end

    defmodule Klarna do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `currency` - The currency of the setup intent. Three letter ISO currency code. Format: ISO 4217 currency code. Nullable.
      * `preferred_locale` - Preferred locale of the Klarna checkout page that the customer is redirected to. Max length: 5000. Nullable.
      """
      @type t :: %__MODULE__{
              currency: String.t() | nil,
              preferred_locale: String.t() | nil
            }
      defstruct [:currency, :preferred_locale]
    end

    defmodule Link do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `persistent_token` - [Deprecated] This is a legacy parameter that no longer has any function. Max length: 5000. Nullable.
      """
      @type t :: %__MODULE__{
              persistent_token: String.t() | nil
            }
      defstruct [:persistent_token]
    end

    defmodule Paypal do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `billing_agreement_id` - The PayPal Billing Agreement ID (BAID). This is an ID generated by PayPal which represents the mandate between the merchant and the customer. Max length: 5000. Nullable.
      """
      @type t :: %__MODULE__{
              billing_agreement_id: String.t() | nil
            }
      defstruct [:billing_agreement_id]
    end

    defmodule Payto do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `mandate_options`
      """
      @type t :: %__MODULE__{
              mandate_options: __MODULE__.MandateOptions.t() | nil
            }
      defstruct [:mandate_options]

      defmodule MandateOptions do
        @moduledoc "Nested struct within the parent resource."

        @typedoc """
        * `amount` - Amount that will be collected. It is required when `amount_type` is `fixed`. Nullable.
        * `amount_type` - The type of amount that will be collected. The amount charged must be exact or up to the value of `amount` param for `fixed` or `maximum` type respectively. Defaults to `maximum`. Possible values: `fixed`, `maximum`. Nullable.
        * `end_date` - Date, in YYYY-MM-DD format, after which payments will not be collected. Defaults to no end date. Max length: 5000. Nullable.
        * `payment_schedule` - The periodicity at which payments will be collected. Defaults to `adhoc`. Possible values: `adhoc`, `annual`, `daily`, `fortnightly`, `monthly`, `quarterly`, `semi_annual`, `weekly`. Nullable.
        * `payments_per_period` - The number of payments that will be made during a payment period. Defaults to 1 except for when `payment_schedule` is `adhoc`. In that case, it defaults to no limit. Nullable.
        * `purpose` - The purpose for which payments are made. Has a default value based on your merchant category code. Possible values: `dependant_support`, `government`, `loan`, `mortgage`, `other`, `pension`, `personal`, `retail`, `salary`, `tax`, `utility`. Nullable.
        * `start_date` - Date, in YYYY-MM-DD format, from which payments will be collected. Defaults to confirmation time. Max length: 5000. Nullable.
        """
        @type t :: %__MODULE__{
                amount: integer() | nil,
                amount_type: String.t() | nil,
                end_date: String.t() | nil,
                payment_schedule: String.t() | nil,
                payments_per_period: integer() | nil,
                purpose: String.t() | nil,
                start_date: String.t() | nil
              }
        defstruct [
          :amount,
          :amount_type,
          :end_date,
          :payment_schedule,
          :payments_per_period,
          :purpose,
          :start_date
        ]
      end

      def __inner_types__ do
        %{
          "mandate_options" => __MODULE__.MandateOptions
        }
      end
    end

    defmodule SepaDebit do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `mandate_options`
      """
      @type t :: %__MODULE__{
              mandate_options: Stripe.Resources.SepaDebitMandateOptions.t() | nil
            }
      defstruct [:mandate_options]
    end

    defmodule UsBankAccount do
      @moduledoc "Nested struct within the parent resource."

      @typedoc """
      * `financial_connections`
      * `mandate_options`
      * `verification_method` - Bank account verification method. Possible values: `automatic`, `instant`, `microdeposits`.
      """
      @type t :: %__MODULE__{
              financial_connections: __MODULE__.FinancialConnections.t() | nil,
              mandate_options: __MODULE__.MandateOptions.t() | nil,
              verification_method: String.t() | nil
            }
      defstruct [:financial_connections, :mandate_options, :verification_method]

      defmodule FinancialConnections do
        @moduledoc "Nested struct within the parent resource."

        @typedoc """
        * `filters`
        * `permissions` - The list of permissions to request. The `payment_method` permission must be included.
        * `prefetch` - Data features requested to be retrieved upon account creation. Nullable.
        * `return_url` - For webview integrations only. Upon completing OAuth login in the native browser, the user will be redirected to this URL to return to your app. Max length: 5000.
        """
        @type t :: %__MODULE__{
                filters: __MODULE__.Filters.t() | nil,
                permissions: [String.t()] | nil,
                prefetch: [String.t()] | nil,
                return_url: String.t() | nil
              }
        defstruct [:filters, :permissions, :prefetch, :return_url]

        defmodule Filters do
          @moduledoc "Nested struct within the parent resource."

          @typedoc """
          * `account_subcategories` - The account subcategories to use to filter for possible accounts to link. Valid subcategories are `checking` and `savings`.
          """
          @type t :: %__MODULE__{
                  account_subcategories: [String.t()] | nil
                }
          defstruct [:account_subcategories]
        end

        def __inner_types__ do
          %{
            "filters" => __MODULE__.Filters
          }
        end
      end

      defmodule MandateOptions do
        @moduledoc "Nested struct within the parent resource."

        @typedoc """
        * `collection_method` - Mandate collection method Possible values: `paper`.
        """
        @type t :: %__MODULE__{
                collection_method: String.t() | nil
              }
        defstruct [:collection_method]
      end

      def __inner_types__ do
        %{
          "financial_connections" => __MODULE__.FinancialConnections,
          "mandate_options" => __MODULE__.MandateOptions
        }
      end
    end

    def __inner_types__ do
      %{
        "acss_debit" => __MODULE__.AcssDebit,
        "bacs_debit" => __MODULE__.BacsDebit,
        "card" => __MODULE__.Card,
        "klarna" => __MODULE__.Klarna,
        "link" => __MODULE__.Link,
        "paypal" => __MODULE__.Paypal,
        "payto" => __MODULE__.Payto,
        "sepa_debit" => __MODULE__.SepaDebit,
        "us_bank_account" => __MODULE__.UsBankAccount
      }
    end
  end

  def __inner_types__ do
    %{
      "automatic_payment_methods" => __MODULE__.AutomaticPaymentMethods,
      "last_setup_error" => Stripe.Resources.StripeError,
      "next_action" => __MODULE__.NextAction,
      "payment_method_configuration_details" => __MODULE__.PaymentMethodConfigurationDetails,
      "payment_method_options" => __MODULE__.PaymentMethodOptions
    }
  end
end
